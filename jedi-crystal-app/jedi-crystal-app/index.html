<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jedi Habit Tracker (Prototype)</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="css/style.css" />
  <meta name="theme-color" content="#0b1020" />

  <!-- CDN libs for hosted use. If offline/local with no internet, the app will fallback to the 2D renderer. -->
  <script defer src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
</head>
<body>
  <div id="app">
    <header class="app-header">
      <h1 class="brand">Jedi Tracker</h1>
      <nav class="top-nav">
        <button class="link" data-screen="home">Home</button>
        <button class="link" data-screen="missions">Missions</button>
        <button class="link" data-screen="rewards">Rewards</button>
        <button class="link" data-screen="customize">Customize</button>
        <button class="link" data-screen="parent">Parent</button>
      </nav>
    </header>

    <main>
      <!-- HOME -->
      <section class="screen active" id="screen-home">
        <div class="hero">
          <div id="crystal-wrap">
            <canvas id="crystalCanvas" width="320" height="320"></canvas>
            <div id="threejs-mount" aria-hidden="true"></div>
          </div>
          <div class="stats">
            <div class="stat">
              <span class="label">Rank</span>
              <span id="rankName" class="value">Youngling</span>
            </div>
            <div class="stat">
              <span class="label">XP</span>
              <span id="xpValue" class="value">0</span>
            </div>
            <div class="stat">
              <span class="label">Alignment</span>
              <span id="alignmentLabel" class="value">Light Side</span>
            </div>
          </div>
          <div class="hint">Tip: check Missions to earn XP and shift alignment.</div>
        </div>
      </section>

      <!-- MISSIONS -->
      <section class="screen" id="screen-missions">
        <h2>Today's Missions</h2>
        <ul id="mission-list" class="list"></ul>
        <div class="row gap">
          <button id="refreshMissions" class="secondary">Refresh (debug)</button>
          <button class="link" data-screen="home">Back</button>
        </div>
      </section>

      <!-- REWARDS -->
      <section class="screen" id="screen-rewards">
        <h2>Rewards</h2>
        <ul id="reward-list" class="list">
          <!-- Populated by script -->
        </ul>
        <button class="link" data-screen="home">Back</button>
      </section>

      <!-- CUSTOMIZE -->
      <section class="screen" id="screen-customize">
        <h2>Customize</h2>
        <div class="grid2">
          <div class="card">
            <h3>Lightsaber Color</h3>
            <div class="row wrap gap">
              <button class="chip color" data-saber="#00E5FF" title="Cyan"></button>
              <button class="chip color" data-saber="#00FF6A" title="Green"></button>
              <button class="chip color" data-saber="#FFD400" title="Yellow"></button>
              <button class="chip color" data-saber="#7A00FF" title="Violet"></button>
              <button class="chip color" data-saber="#FF0033" title="Red"></button>
            </div>
          </div>
          <div class="card">
            <h3>Robe Style</h3>
            <div class="row wrap gap">
              <button class="chip" data-robe="Padawan">Padawan</button>
              <button class="chip" data-robe="Knight">Knight</button>
              <button class="chip" data-robe="Master">Master</button>
            </div>
          </div>
          <div class="card">
            <h3>Crystal Style</h3>
            <div class="row wrap gap">
              <button class="chip" data-crystal="octa">Octahedron</button>
              <button class="chip" data-crystal="elongated">Elongated</button>
              <button class="chip" data-crystal="shard">Shard</button>
            </div>
          </div>
        </div>
        <button class="link" data-screen="home">Back</button>
      </section>

      <!-- PARENT -->
      <section class="screen" id="screen-parent">
        <h2>Parent Console</h2>
        <div id="parent-gate" class="card">
          <label>Enter PIN: <input id="pinInput" type="password" placeholder="1234" /></label>
          <button id="pinBtn">Unlock</button>
        </div>
        <div id="parent-panel" class="hidden">
          <div class="grid2">
            <div class="card">
              <h3>Manage Missions</h3>
              <div class="row gap">
                <input id="mName" placeholder="Mission name" />
                <input id="mEffect" type="number" placeholder="-5 for Light, +5 for Dark" />
                <input id="mXP" type="number" placeholder="XP (e.g., 5)" />
                <button id="addMission">Add</button>
              </div>
            </div>
            <div class="card">
              <h3>Rewards Catalog</h3>
              <div class="row gap">
                <input id="rName" placeholder="Reward name" />
                <input id="rCost" type="number" placeholder="Cost (XP)" />
                <button id="addReward">Add</button>
              </div>
            </div>
            <div class="card">
              <h3>Data</h3>
              <div class="row gap wrap">
                <button id="exportBtn">Export JSON</button>
                <input id="importFile" type="file" accept="application/json" />
                <button id="importBtn">Import</button>
                <button id="resetAll" class="danger">Factory Reset</button>
              </div>
            </div>
          </div>
        </div>
        <button class="link" data-screen="home">Back</button>
      </section>
    </main>
  </div>

  <script src="js/crystal.js" defer></script>
  <script src="js/script.js" defer></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
</body>
</html>
